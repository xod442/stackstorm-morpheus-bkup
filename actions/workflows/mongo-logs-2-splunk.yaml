version: 1.0

description: A workflow to copy Morpheus logs from mongo and into splunk..

tasks:
  getalerts:
    action: morpheus.get_logs
    next:
      - when: <% succeeded() %>
        publish:
          - logs: <% result().result %>
        do: logalerts

  logalerts:
    with: <% ctx().events %>
    action: servicenow.create_record table="u_nimble_alarms" payload='<% item() %>'
    next:
      - when: <% succeeded() %>
        do: processlogs

  processlogs:
    action: morpheus.process_logs logs=<% ctx().alarms %>
