version: 1.0

description: A workflow to copy Morpheus logs from mongo and into splunk..

tasks:
  gettoken:
    action: splunk.get_hec_token
    next:
      - when: <% succeeded() %>
        publish:
          - token: <% result().result %>
        do: getlogs
  getlogs:
    action: morpheus.get_logs
    next:
      - when: <% succeeded() %>
        publish:
          - events: <% result().result %>
        do: sendsplunk

  sendsplunk:
    with: <% ctx().logs %>
    action: splunk.send_log index="main" token=<% ctx().token event='<% item() %>'
